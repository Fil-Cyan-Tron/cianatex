%Requires texlive 2024
\ProvidesPackage{cianatex}

%Pacchetti

    %Layout pagina
        \usepackage[a4paper, margin=15mm]{geometry}

    %Roba per la lingua
        %codifica del testo
            \RequirePackage[utf8]{inputenc}
        %font italiani
            \RequirePackage[T1]{fontenc}
        %elementi di linguaggio
            \RequirePackage[italian]{babel}

    %TODO: pacchetti per le immagini (per ora frega sega)

    %Plots
        \RequirePackage{tikz}
        \RequirePackage{tikz-3dplot}

    %Disegnini di Drago
        \RequirePackage{phaistos}

    %Ambienti
        %Box colorate
            \RequirePackage[most]{tcolorbox}
            \tcbuselibrary{theorems}
            \tcbuselibrary{skins}

    %Tabelle
        %Tabelle di base
            \RequirePackage{array}
        %Tabelle grosse
            \RequirePackage{longtable}
        %Dimensionamento delle colonne
            \RequirePackage{multirow}
        %Multicolonne
            \RequirePackage{multicol}

    %Diagrammi commutativi
        \RequirePackage{quiver}
        \usetikzlibrary{nfold}

    %Disegnini
        \usetikzlibrary{patterns}

    %Collegamenti
        %Url cliccabili
            \RequirePackage{url}
        %Tavole dei contenuti et cetera
            \RequirePackage{hyperref}

    %ICONE FIGHISSIME
        \RequirePackage{rpgicons}

    %Codice
        \RequirePackage{listings}

    %Bibliografia
        %Quotes
            \RequirePackage{csquotes}
        %Bibliografia
            \RequirePackage[backend=biber, sorting=ydnt, bibstyle=ieee]{biblatex}
        %Citazioni lapidare
            \RequirePackage{epigraph}

    %Simboli e font
        %I vari simboli degli insiemi numerici
            \RequirePackage{amsfonts}
        %Coefficienti binomiali
            \RequirePackage{amsmath}
        %Insieme vuoto per davvero con \varnothing che poi rinominiamo in \vuoto
            \RequirePackage{amssymb}
        %Arco con \wideparen{AB}
            \RequirePackage{yhmath}
        %Testo barrato
            \RequirePackage{cancel}
        %Integrali bizzarri tipo \fint
            \RequirePackage{esint}

%Opzioni

    %Colorcoding
    
        %Standard https://colorkit.co/palette/ff595e-ff924c-ffca3a-c5ca30-8ac926-52a675-1982c4-4267ac-6a4c93/
            \definecolor{theoremcolor}{HTML}{ff595e} %Rosso
            \definecolor{proofcolor}{HTML}{ff924c} %Arancio
            \definecolor{definitioncolor}{HTML}{8ac926} %Verde
            \definecolor{propositioncolor}{HTML}{1982c4} %Azzurro
            \definecolor{remarkcolor}{HTML}{6a4c93} %Viola
            \definecolor{examplecolor}{HTML}{ffca3a} %Giallo
            \definecolor{notationcolor}{HTML}{c5ca30} %Giallastro
            \definecolor{corollarycolor}{HTML}{52a675} %Verde cobalto
            \definecolor{lemmacolor}{HTML}{4267ac} %Bluastro-ciano

        %Colori pastello
            \DeclareOption{pastel}{
                \definecolor{theoremcolor}{HTML}{0.9, 0.31, 0.28} %rosso pastello
                \definecolor{proofcolor}{HTML}{0.9, 0.6, 0.28} %arancio pastello
                \definecolor{definitioncolor}{HTML}{0.37, 0.77, 0.37} %verde pastello
                \definecolor{propositioncolor}{HTML}{0.58, 0.68, 0.81} %blu pastello
                \definecolor{remarkcolor}{HTML}{0.7, 0.5, 0.69} %viola :)
                \definecolor{examplecolor}{HTML}{0.96, 0.6, 0.76} %magenta
                \definecolor{notationcolor}{HTML}{0.47, 0.27, 0.23} %Bole
                \definecolor{corollarycolor}{HTML}{1.0, 0.75, 0} %ambra
                \definecolor{lemmacolor}{HTML}{0.0, 0.36, 0.25} %british racing green
                }

        %Grigio depresso
            \DeclareOption{depression}{
                \definecolor{theoremcolor}{HTML}{404040}
                \definecolor{proofcolor}{HTML}{404040}
                \definecolor{definitioncolor}{HTML}{404040}
                \definecolor{propositioncolor}{HTML}{404040}
                \definecolor{remarkcolor}{HTML}{404040}
                \definecolor{examplecolor}{HTML}{404040}
                \definecolor{notationcolor}{HTML}{404040}
                \definecolor{corollarycolor}{HTML}{404040}
                \definecolor{lemmacolor}{HTML}{404040}
            }

        %Zun
            \DeclareOption{zun}{
                \definecolor{theoremcolor}{HTML}{C8D6FD}
                \definecolor{proofcolor}{HTML}{C8D6FD}
                \definecolor{definitioncolor}{HTML}{C8D6FD}
                \definecolor{propositioncolor}{HTML}{C8D6FD}
                \definecolor{remarkcolor}{HTML}{C8D6FD}
                \definecolor{examplecolor}{HTML}{C8D6FD}
                \definecolor{notationcolor}{HTML}{C8D6FD}
            }

\ProcessOptions\relax

%Roba nuova per davvero
    %roba basic
        %Emph più bellino
            \newcommand{\bemph}[1]{\textbf{\emph{#1}}}
        %Insieme vuoto bello
            \newcommand\vuoto\varnothing
            \renewcommand\emptyset\vuoto
        %Simbolo del parallelismo
            \newcommand\parallelo{{/\!/}}
        %Mcd
            \newcommand\mcd{\operatorname{mcd}}
        %Tette, tette iperboliche e arcotette in italiano
            \newcommand\sen{\operatorname{sen}}
            \renewcommand\sin\sen
            \newcommand\senh{\operatorname{senh}}
            \renewcommand\sinh\senh
            \newcommand\arcsen{\operatorname{arcsen}}
            \renewcommand\arcsin\arcsen
        %Tangentopoli, cotangentopoli, arcotangentopoli e arcocotangentopoli con la tg
            \newcommand\tg{\operatorname{tg}}
            \newcommand\cotg{\operatorname{cotg}}
            \newcommand\arctg{\operatorname{arctg}}
            \newcommand\arccotg{\operatorname{arccotg}}
        %Parti immaginarie e reali
            \renewcommand\Im{\operatorname{Im}}
            \renewcommand\Re{\operatorname{Re}}
        %Dominio
            \newcommand\dom{\operatorname{dom}}
        %Rango
            \newcommand\rk{\operatorname{rk}}
        %Grado
            \renewcommand\deg{\operatorname{deg}}
        %Sottostrutture e sovrastrutture
            \newcommand\substruct\vartriangleleft
            \newcommand\superstruct\vartriangleright
        %Implicazioni
            \newcommand\Harr\Leftrightarrow
            \newcommand\Rarr\Rightarrow
            \newcommand\Larr\Leftarrow
        %Definizione della funzione bella bella, gli argomenti sono [nome, dominio, codominio, variabile, funzione]
            \newcommand{\definefunction}[5]{
                \begin{array}{cccc}
                    #1 :  & #2 & \longrightarrow & #3\\
                    \quad & #4 &   \longmapsto   & #5
                \end{array}
                }
        %Insiemi numerici
            \newcommand\N{\mathbb{N}} %Naturali
            \newcommand\Z{\mathbb{Z}} %Interi
            \newcommand\Q{\mathbb{Q}} %Razionali
            \newcommand\R{\mathbb{R}} %Reali
            \newcommand\C{\mathbb{C}} %Complessi
        %Entità algebriche
            \newcommand\K{\mathbb{K}} %Campi in geometria
            \newcommand\F{\mathbb{F}} %Campi in algebra
            \newcommand\G{\mathcal{G}} %Gruppi, occasionalmente
        %Entità geometriche
            \newcommand\A{\mathbb{A}} %Spazi affini, anelli occasionalmente
            \renewcommand\P{\mathbb{P}} %Spazi proiettivi
            \newcommand\E{\mathbb{E}} %Spazi euclidei
        %Misure
            \renewcommand\L{\mathcal{L}} %Misura di Lebesgue, o pre-spazio L
            \renewcommand\H{\mathcal{H}} %Misura di Hausdorff
        %Intorni
            \newcommand\U{\mathcal{U}}
            \newcommand\V{\mathcal{V}}
        %Altro
            \newcommand\parti{\mathcal{P}} %Insieme delle parti
            \newcommand\B{\mathcal{B}} %Boreliani
            \newcommand{\comp}{\mathcal{K}} %Compatti 
            \newcommand\M{\mathcal{M}} %Misurabili 
            \newcommand{\tribu}{\mathcal{F}} %Tribù in probabilità
            \newcommand{\bin}[2]{\begin{pmatrix} #1 \\ #2 \end{pmatrix}} %Coefficiente binomiale
            \newcommand\de{\text{ d}} %d per gli integrali
            \newcommand\embin{\hookrightarrow} %immerso in
            \newcommand\embout{\hookleftarrow} %in cui è immerso
            \newcommand\supp{\operatorname{supp}} %supporto
            \newcommand\Nick{\ability[positive]{charisma}[frame=spellschool, scale=0.5]\:} %proof by nick drake
            \renewcommand\S{\mathbb{S}} %Sfera
            \newcommand\Loc{\operatorname{L}_{\text{loc}}}
            \newcommand\ind{\mathbf{1}}
            \newcommand\Var{\operatorname{Var}}
            \newcommand\Twitter{\mathcal{X}}
        %Variabili aleatorie
            %Discrete
                \newcommand\binva{\operatorname{bin}}
                \newcommand\poisva{\operatorname{pois}}
                \newcommand\geomva{\operatorname{geom}}
                \newcommand\hyperva{\operatorname{hyper}}
            %Assolutamente continue
                \newcommand\normva{\mathcal{N}}
                \newcommand\unifva{\operatorname{unif}}
                %exp, chi^2 e t esistono già
        %Shortcuts per mathcal, mathbb e mathbf
            \newcommand{\mc}[1]{\mathcal{#1}}
            \newcommand{\mbb}[1]{\mathbb{#1}}
            \newcommand{\mbf}[1]{\mathbf{#1}}
        %Categories
            \newcommand\mor{\operatorname{mor}}
            \newcommand\ob{\operatorname{ob}}
            \newcommand{\catname}[1]{\text{\sffamily\textbf{#1}}}
            \newcommand\setcat{\catname{Set}}
            \newcommand\topcat{\catname{Top}}
            \newcommand\grpcat{\catname{Grp}}
            \newcommand\veccat{\catname{Vec}}
            \newcommand\fldcat{\catname{Fld}}
            \newcommand\graphcat{\catname{Graph}}
            \newcommand\meascat{\catname{Meable}}
            \newcommand{\id}[1]{\operatorname{id}_{#1}}
            \newcommand\cattimes{\mathbf{\Pi}}

    %Ambienti

        %Teoremi, proposizioni et cetera
            


            \newtcbtheorem[number within=section]{theorem}{Teorema}{
                enhanced,
                breakable,
                colback=white,
                colframe=theoremcolor,
                fonttitle=\bfseries,
                sharp corners
                }{th}
            % \newtcolorbox{proofbox}{
            %     enhanced,
            %     breakable,
            %     colback=white,
            %     colframe=proofcolor, 
            %     fonttitle=\bfseries, 
            %     title=Dimostrazione,
            %     sharp corners
            %     }
            % \newenvironment{proof}{\proofbox}{\begin{flushright}$\square$\end{flushright}\endproofbox}
            \newtcbtheorem[number within=section]{definition}{Definizione}{
                enhanced,
                breakable,
                colback=white,
                colframe=definitioncolor,
                fonttitle=\bfseries,
                sharp corners
                }{def}
            \newtcbtheorem[number within=section]{proposition}{Proposizione}{
                enhanced,
                breakable,
                colback=white,
                colframe=propositioncolor,
                fonttitle=\bfseries,
                sharp corners
                }{prop}
            \newtcbtheorem[number within=section]{remark}{Osservazione}{
                enhanced,
                breakable,
                colback=white,
                colframe=remarkcolor,
                fonttitle=\bfseries,
                sharp corners
                }{rem}
            \newtcbtheorem[number within=section]{example}{Esempio}{
                enhanced,
                breakable,
                colback=white,
                colframe=examplecolor,
                fonttitle=\bfseries,
                sharp corners
                }{exmp}
            \newtcolorbox{notation}{
                enhanced,
                breakable,
                colback=white,
                colframe=notationcolor, 
                fonttitle=\bfseries, 
                title=Notazione,
                sharp corners}
            \newtcbtheorem[number within=section]{corollary}{Corollario}{
                enhanced,
                breakable,
                colback=white,
                colframe=corollarycolor,
                fonttitle=\bfseries,
                sharp corners
                }{cor}
            \newtcbtheorem[number within=section]{lemma}{Lemma}{
                enhanced,
                breakable,
                colback=white,
                colframe=lemmacolor,
                fonttitle=\bfseries,
                sharp corners
                }{lemma}
            \newtcbtheorem[number within=section]{conjecture}{Congettura}{
                enhanced,
                breakable,
                colback=white,
                colframe=lemmacolor,
                fonttitle=\bfseries,
                sharp corners
                }{conjecture}

            \newcommand\proof{ \\ \tcblower \paragraph*{Dimostrazione.}}

            \newtcbtheorem[number within=section]{Ptheorem}{Teorema}{
                enhanced,
                breakable,
                colback=theoremcolor!5,
                colframe=theoremcolor,
                fonttitle=\bfseries,
                sharp corners,
                upperbox=visible,
                segmentation hidden,
                lowerbox=visible,
                }{Pth}